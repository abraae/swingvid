<!DOCTYPE html>
<html>
<head>
    <title>RecordRTC with Selective Slices Combination</title>
    <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
</head>
<body>
    <video id="video" controls autoplay></video>
    <button id="startRecording">Start Recording</button>
    <button id="stopRecording" disabled>Stop Recording</button>
    <a id="downloadLink" style="display:none;">Download Video</a>

    <script>
        let video = document.getElementById('video');
        let startRecordingButton = document.getElementById('startRecording');
        let stopRecordingButton = document.getElementById('stopRecording');
        let downloadLink = document.getElementById('downloadLink');

        let recorder;
        let stream;
        let recordedBlobs = [];

        startRecordingButton.onclick = async () => {
            stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
            video.srcObject = stream;

            recorder = new RecordRTC(stream, {
                type: 'video',
                timeSlice: 1000, // 1 second
                ondataavailable: (blob) => {
                    recordedBlobs.push(blob);
                }
            });

            recorder.startRecording();
            startRecordingButton.disabled = true;
            stopRecordingButton.disabled = false;
        };

        stopRecordingButton.onclick = () => {
            recorder.stopRecording(() => {
                // Select the first slice and the last four slices
                let selectedBlobs = [];
                if (recordedBlobs.length > 0) {
                    selectedBlobs.push(recordedBlobs[0]);
                }
                if (recordedBlobs.length > 4) {
                    selectedBlobs.push(...recordedBlobs.slice(-4));
                } else {
                    selectedBlobs.push(...recordedBlobs);
                }

                // Combine selected blobs into one
                let superBuffer = new Blob(selectedBlobs, { type: 'video/webm' });
                let url = URL.createObjectURL(superBuffer);

                downloadLink.href = url;
                downloadLink.download = 'recorded-video.webm';
                downloadLink.style.display = 'block';
                video.srcObject = null;
                video.src = url;

                stream.getTracks().forEach(track => track.stop());
                startRecordingButton.disabled = false;
                stopRecordingButton.disabled = true;
            });
        };
    </script>
</body>
</html>
