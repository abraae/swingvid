<!DOCTYPE html>
<html>
<head>
    <title>RecordRTC Example</title>
    <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
</head>
<body>
    <video id="video" controls autoplay></video>
    <button id="startRecording">Start Recording</button>
    <button id="stopRecording" disabled>Stop Recording</button>
    <a id="downloadLink" style="display:none;">Download Video</a>

    <script>
        let video = document.getElementById('video');
        let startRecordingButton = document.getElementById('startRecording');
        let stopRecordingButton = document.getElementById('stopRecording');
        let downloadLink = document.getElementById('downloadLink');

        let recorder;
        let stream;
        let recordedBlobs = [];
        let recordingStartTime;

        startRecordingButton.onclick = async () => {
            stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
            video.srcObject = stream;

            recordedBlobs = [];
            recorder = new RecordRTC(stream, {
                type: 'video',
                mimeType: 'video/webm;codecs=vp8',
                timeSlice: 1000, // Record in slices of 1 second
                ondataavailable: (blob) => {
                    recordedBlobs.push(blob);
                    if (recordedBlobs.length > 3) {
                        recordedBlobs.shift(); // Keep only the last 3 seconds
                    }
                }
            });

            recorder.startRecording();
            recordingStartTime = Date.now();
            startRecordingButton.disabled = true;
            stopRecordingButton.disabled = false;
        };

        stopRecordingButton.onclick = () => {
            recorder.stopRecording(() => {
                let finalBlob = new Blob(recordedBlobs, { type: 'video/webm' });
                let url = URL.createObjectURL(finalBlob);
                
                downloadLink.href = url;
                downloadLink.download = 'recorded-video.webm';
                downloadLink.style.display = 'block';
                video.srcObject = null;
                video.src = url;

                stream.getTracks().forEach(track => track.stop());
                startRecordingButton.disabled = false;
                stopRecordingButton.disabled = true;
            });
        };
    </script>
</body>
</html>
